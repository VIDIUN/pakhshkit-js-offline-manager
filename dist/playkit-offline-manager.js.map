{"version":3,"sources":["./offline-manager/webpack/universalModuleDefinition","./offline-manager/playkit-offline-manager.js","./offline-manager/webpack/bootstrap c44ca3d49c29ac55e7c6","./offline-manager/external {\"commonjs\":\"playkit-js\",\"commonjs2\":\"playkit-js\",\"amd\":\"playkit-js\",\"root\":[\"playkit\",\"core\"]}","./offline-manager/./index.js","./offline-manager/./offline-manager.js","./offline-manager/./shaka-offline-wrapper.js","./offline-manager/external {\"commonjs\":\"shaka-player\",\"commonjs2\":\"shaka-player\",\"amd\":\"shaka-player\",\"root\":\"shaka\"}","./offline-manager/./db-manager.js","./offline-manager/../node_modules/idb/lib/idb.js","./offline-manager/external {\"commonjs\":\"playkit-js-providers\",\"commonjs2\":\"playkit-js-providers\",\"amd\":\"playkit-js-providers\",\"root\":[\"playkit\",\"providers\"]}"],"names":["root","factory","exports","module","require","define","amd","self","this","__WEBPACK_EXTERNAL_MODULE_0__","__WEBPACK_EXTERNAL_MODULE_4__","__WEBPACK_EXTERNAL_MODULE_7__","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","value","NAME","VERSION","OfflineManager","undefined","_offlineManager","_offlineManager2","obj","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","length","descriptor","key","protoProps","staticProps","_shakaOfflineWrapper","_shakaOfflineWrapper2","_playkitJsProviders","_playkitJs","_FakeEventTarget","config","_this","getPrototypeOf","_downloads","_config","_eventManager","EventManager","_setOfflineAdapter","_this2","listen","e","dispatchEvent","mediaInfo","_this3","Promise","resolve","reject","Provider","provider","getMediaConfig","then","mediaConfig","Utils","hasPropertyPath","sources","dash","sourceData","entryId","pause","resume","url","options","download","deleteMedia","getDataByEntry","getAllDownloads","destroy","FakeEventTarget","_interopRequireDefault","_shakaPlayer","_shakaPlayer2","_dbManager","_dbManager2","downloadStates","DOWNLOADING","PAUSED","RESUMED","ENDED","actions","PAUSE","RESUME","DELETE","DOWNLOAD_START","DOWNLOAD_END","ShakaOfflineWrapper","downloads","_dtgVideoElement","document","createElement","polyfill","installAll","_dtgShaka","Player","log","setLevel","Level","DEBUG","adapterName","adapterVersion","playerVersion","currentDownload","_configureDrmIfNeeded","_initStorage","storage","store","offlineManifest","state","downloadStatus","offlineUri","add","_prepareItemForStorage","action","catch","includes","update","_this4","_setSessionData","manifestDB","ob","_this5","DELETED","remove","getAll","drmData","servers","forEach","val","scheme","licenseUrl","configure","drm","keysToDelete","storeObj","assign","_this6","dbData","data","arguments","offline","Storage","configuration","usePersistentLicense","progressCallback","_setDownloadProgress","trackSelectionCallback","_this7","content","progress","event","FakeEvent","detail","_idb","_idb2","DB_NAME","DBManager","window","open","dbPromise","upgradeDb","objectStoreNames","contains","createObjectStore","keyPath","storeName","item","db","tx","transaction","objectStore","_addConfigToItem","put","complete","delete","allObjs","toArray","arr","Array","slice","promisifyRequest","request","onsuccess","result","onerror","error","promisifyRequestCall","method","args","apply","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","prop","set","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Index","index","_index","cursor","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","oldVersion","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","replace","callback","nativeObject","query","count","items","iterateCursor","push","continue","exp","version","upgradeCallback","indexedDB","onupgradeneeded"],"mappings":"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","file":"playkit-offline-manager.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"playkit-js\"), require(\"shaka-player\"), require(\"playkit-js-providers\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"playkit-js\", \"shaka-player\", \"playkit-js-providers\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"OfflineManager\"] = factory(require(\"playkit-js\"), require(\"shaka-player\"), require(\"playkit-js-providers\"));\n\telse\n\t\troot[\"playkit\"] = root[\"playkit\"] || {}, root[\"playkit\"][\"OfflineManager\"] = factory(root[\"playkit\"][\"core\"], root[\"shaka\"], root[\"playkit\"][\"providers\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"playkit-js\"), require(\"shaka-player\"), require(\"playkit-js-providers\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"playkit-js\", \"shaka-player\", \"playkit-js-providers\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"OfflineManager\"] = factory(require(\"playkit-js\"), require(\"shaka-player\"), require(\"playkit-js-providers\"));\n\telse\n\t\troot[\"playkit\"] = root[\"playkit\"] || {}, root[\"playkit\"][\"OfflineManager\"] = factory(root[\"playkit\"][\"core\"], root[\"shaka\"], root[\"playkit\"][\"providers\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 1);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NAME = exports.VERSION = exports.OfflineManager = undefined;\n\nvar _offlineManager = __webpack_require__(2);\n\nvar _offlineManager2 = _interopRequireDefault(_offlineManager);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.OfflineManager = _offlineManager2.default;\nexports.VERSION = \"1.0.0\";\nexports.NAME = \"playkit-js-offline-manager\";\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _shakaOfflineWrapper = __webpack_require__(3);\n\nvar _shakaOfflineWrapper2 = _interopRequireDefault(_shakaOfflineWrapper);\n\nvar _playkitJsProviders = __webpack_require__(7);\n\nvar _playkitJs = __webpack_require__(0);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n * Your class description.\n * @classdesc\n */\nvar OfflineManager = function (_FakeEventTarget) {\n  _inherits(OfflineManager, _FakeEventTarget);\n\n  _createClass(OfflineManager, null, [{\n    key: 'isValid',\n\n\n    /**\n     * TODO: Define under what conditions the plugin is valid.\n     * @static\n     * @public\n     * @returns {boolean} - Whether the plugin is valid.\n     */\n    value: function isValid() {\n      return true;\n    }\n\n    /**\n     * @constructor\n     * @param {Object} config - The plugin config.\n     */\n\n  }]);\n\n  function OfflineManager(config) {\n    _classCallCheck(this, OfflineManager);\n\n    var _this = _possibleConstructorReturn(this, (OfflineManager.__proto__ || Object.getPrototypeOf(OfflineManager)).call(this));\n\n    if (_this._downloads) {\n      return _possibleConstructorReturn(_this);\n    }\n    // this.config = config;\n    _this._downloads = {};\n    _this._config = config;\n    _this._eventManager = new _playkitJs.EventManager();\n    _this._setOfflineAdapter();\n\n    /**\n     Now you have access to the BasePlugin members:\n     1. config: The runtime configuration of the plugin.\n     2. name: The name of the plugin.\n     3. logger: The logger of the plugin.\n     4. player: Reference to the actual player.\n     5. eventManager: The event manager of the plugin.\n    */\n    return _this;\n  }\n\n  _createClass(OfflineManager, [{\n    key: '_setOfflineAdapter',\n    value: function _setOfflineAdapter() {\n      var _this2 = this;\n\n      // if (this.config.manager === 'shaka'){\n      this._offlineManager = new _shakaOfflineWrapper2.default(this._downloads);\n      this._eventManager.listen(this._offlineManager, \"progress\", function (e) {\n        debugger;\n        _this2.dispatchEvent(e);\n      });\n      // }\n    }\n  }, {\n    key: 'getMediaInfo',\n    value: function getMediaInfo(mediaInfo) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        var provider = new _playkitJsProviders.Provider(_this3._config.provider);\n        provider.getMediaConfig(mediaInfo).then(function (mediaConfig) {\n          if (_playkitJs.Utils.Object.hasPropertyPath(mediaConfig, 'sources.dash') && mediaConfig.sources.dash.length > 0) {\n            var sourceData = mediaConfig.sources.dash[0];\n            sourceData.entryId = mediaInfo.entryId;\n            _this3._downloads[mediaInfo.entryId] = mediaConfig;\n            resolve(sourceData);\n          } else {\n            reject(\"getMediaInfo error\");\n          }\n        });\n      });\n    }\n  }, {\n    key: 'pause',\n    value: function pause(entryId) {\n      return this._offlineManager.pause(entryId);\n    }\n  }, {\n    key: 'resume',\n    value: function resume(entryId) {\n      return this._offlineManager.resume(entryId);\n    }\n  }, {\n    key: 'download',\n    value: function download(url, options) {\n      return this._offlineManager.download(url, options);\n    }\n  }, {\n    key: 'deleteMedia',\n    value: function deleteMedia(entryId) {\n      return this._offlineManager.deleteMedia(entryId);\n    }\n  }, {\n    key: 'getMediaInfoFromDB',\n    value: function getMediaInfoFromDB(entryId) {\n      return this._offlineManager.getDataByEntry(entryId);\n    }\n  }, {\n    key: 'getAllDownloads',\n    value: function getAllDownloads() {\n      return this._offlineManager.getAllDownloads();\n    }\n\n    /**\n     * TODO: Define the destroy logic of your plugin.\n     * Destroys the plugin.\n     * @override\n     * @public\n     * @returns {void}\n     */\n\n  }, {\n    key: 'destroy',\n    value: function destroy() {\n      // Write logic\n      this._eventManager.destroy();\n    }\n\n    /**\n     * TODO: Define the reset logic of your plugin.\n     * Resets the plugin.\n     * @override\n     * @public\n     * @returns {void}\n     */\n\n  }, {\n    key: 'reset',\n    value: function reset() {\n      // Write logic\n    }\n  }]);\n\n  return OfflineManager;\n}(_playkitJs.FakeEventTarget);\n\nexports.default = OfflineManager;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _shakaPlayer = __webpack_require__(4);\n\nvar _shakaPlayer2 = _interopRequireDefault(_shakaPlayer);\n\nvar _dbManager = __webpack_require__(5);\n\nvar _dbManager2 = _interopRequireDefault(_dbManager);\n\nvar _playkitJs = __webpack_require__(0);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } //flow\n\n\nvar downloadStates = {\n  DOWNLOADING: 'downloading',\n  PAUSED: 'paused',\n  RESUMED: 'resumed',\n  ENDED: 'ended'\n};\n\nvar actions = {\n  PAUSE: 'pause',\n  RESUME: 'resume',\n  DELETE: 'delete',\n  DOWNLOAD_START: 'downloadStart',\n  DOWNLOAD_END: 'downloadEnd'\n};\n\nvar ENTRIES_MAP_STORE_NAME = 'entriesMap';\n\nvar PROGRESS_EVENT = 'progress';\n\nvar ShakaOfflineWrapper = function (_FakeEventTarget) {\n  _inherits(ShakaOfflineWrapper, _FakeEventTarget);\n\n  function ShakaOfflineWrapper(downloads) {\n    _classCallCheck(this, ShakaOfflineWrapper);\n\n    var _this = _possibleConstructorReturn(this, (ShakaOfflineWrapper.__proto__ || Object.getPrototypeOf(ShakaOfflineWrapper)).call(this));\n\n    _this._dtgVideoElement = document.createElement('video');\n    _shakaPlayer2.default.polyfill.installAll();\n\n    _this._dtgShaka = new _shakaPlayer2.default.Player(_this._dtgVideoElement);\n    if (_shakaPlayer2.default.log) {\n      _shakaPlayer2.default.log.setLevel(_shakaPlayer2.default.log.Level.DEBUG);\n    }\n\n    _this._dbManager = new _dbManager2.default({\n      adapterName: 'shaka',\n      adapterVersion: \"\", //player.version,\n      playerVersion: \"\" //player.version\n    });\n    _this._downloads = downloads;\n    return _this;\n  }\n\n  _createClass(ShakaOfflineWrapper, [{\n    key: 'download',\n    value: function download(entryId, options) {\n      var _this2 = this;\n\n      var currentDownload = this._downloads[entryId];\n      this._configureDrmIfNeeded(entryId);\n      currentDownload['storage'] = this._initStorage(entryId, options);\n      currentDownload['state'] = downloadStates.DOWNLOADING;\n      return currentDownload.storage.store(currentDownload.sources.dash[0].url, {}).then(function (offlineManifest) {\n        currentDownload.state = offlineManifest.downloadStatus === downloadStates.PAUSED ? downloadStates.PAUSED : downloadStates.ENDED;\n        currentDownload.sources.dash[0].url = offlineManifest.offlineUri;\n        return _this2._dbManager.add(ENTRIES_MAP_STORE_NAME, entryId, _this2._prepareItemForStorage(currentDownload)).then(function () {\n          Promise.resolve({\n            action: actions.DOWNLOAD_START,\n            entryId: entryId\n          });\n        });\n      }).catch(function (e) {\n        Promise.reject(e);\n      });\n    }\n  }, {\n    key: 'pause',\n    value: function pause(entryId) {\n      var _this3 = this;\n\n      var currentDownload = this._downloads[entryId];\n      if (!currentDownload) {\n        return Promise.resolve(\"not downloading / resuming\"); //TODO LOG THIS (until background fetch is here)\n      } else {\n        if ([downloadStates.DOWNLOADING, downloadStates.RESUMED].includes(currentDownload.state)) {\n          return currentDownload.storage.pause().then(function () {\n            currentDownload.state = downloadStates.PAUSED;\n            return _this3._dbManager.update(ENTRIES_MAP_STORE_NAME, entryId, _this3._prepareItemForStorage(currentDownload)).then(function () {\n              Promise.resolve({\n                entryId: entryId,\n                action: actions.PAUSE\n              });\n            });\n          }).catch(function (e) {\n            Promise.reject(e);\n          });\n        } else {\n          return Promise.resolve();\n        }\n      }\n    }\n  }, {\n    key: 'resume',\n    value: function resume(entryId) {\n      var _this4 = this;\n\n      return this._setSessionData(entryId).then(function () {\n        var currentDownload = _this4._downloads[entryId];\n        if (currentDownload.state === downloadStates.PAUSED) {\n          currentDownload.state = downloadStates.RESUMED;\n          currentDownload.storage.resume(currentDownload.sources.dash[0].url).then(function (manifestDB) {\n            currentDownload.state = [manifestDB.downloadStatus, manifestDB.ob].includes(downloadStates.ENDED) ? downloadStates.ENDED : downloadStates.PAUSED;\n            _this4._dbManager.update(ENTRIES_MAP_STORE_NAME, entryId, _this4._prepareItemForStorage(currentDownload)).then(function () {\n              return Promise.resolve({\n                action: actions.RESUME,\n                entryId: entryId\n              });\n            });\n          });\n        }\n      }).catch(function (e) {\n        Promise.reject(e);\n      });\n    }\n  }, {\n    key: 'deleteMedia',\n    value: function deleteMedia(entryId) {\n      var _this5 = this;\n\n      return this._setSessionData(entryId).then(function () {\n        var currentDownload = _this5._downloads[entryId];\n        currentDownload.state = downloadStates.DELETED;\n\n        currentDownload.storage.remove(currentDownload.sources.dash[0].url).then(function () {\n          _this5._dbManager.remove(ENTRIES_MAP_STORE_NAME, entryId).then(function () {\n            delete _this5._downloads[entryId];\n            return Promise.resolve({\n              action: actions.DELETED,\n              entryId: entryId\n            });\n          });\n        });\n      }).catch(function (e) {\n        Promise.reject(e);\n      });\n    }\n  }, {\n    key: 'getDataByEntry',\n    value: function getDataByEntry(entryId) {\n      return this._dbManager.get(ENTRIES_MAP_STORE_NAME, entryId);\n    }\n  }, {\n    key: 'getAllDownloads',\n    value: function getAllDownloads() {\n      return this._dbManager.getAll(ENTRIES_MAP_STORE_NAME);\n    }\n  }, {\n    key: '_configureDrmIfNeeded',\n    value: function _configureDrmIfNeeded(entryId) {\n      var currentDownload = this._downloads[entryId];\n      var drmData = currentDownload.sources.dash[0].drmData;\n      if (drmData) {\n        var servers = {};\n        drmData.forEach(function (val) {\n          servers[val.scheme] = val.licenseUrl;\n        });\n        this._dtgShaka.configure({ 'drm': { 'servers': servers } });\n      } else {\n        this._dtgShaka.configure({});\n      }\n    }\n  }, {\n    key: '_prepareItemForStorage',\n    value: function _prepareItemForStorage(object) {\n      var keysToDelete = [\"storage\", \"url\", \"mimetype\"];\n      var storeObj = Object.assign({}, object);\n      for (var key in storeObj) {\n        if (keysToDelete.includes(key)) {\n          delete storeObj[key];\n        }\n      }\n      return storeObj;\n    }\n  }, {\n    key: '_setSessionData',\n    value: function _setSessionData(entryId) {\n      var _this6 = this;\n\n      if (this._downloads[entryId]) {\n        return Promise.resolve();\n      }\n      return this.getDataByEntry(entryId).then(function (dbData) {\n        var data = Object.assign({}, dbData);\n        data['storage'] = _this6._initStorage(entryId);\n        _this6._downloads[entryId] = data;\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: '_initStorage',\n    value: function _initStorage(entryId) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var storage = new _shakaPlayer2.default.offline.Storage(this._dtgShaka);\n      var configuration = {\n        usePersistentLicense: true,\n        progressCallback: this._setDownloadProgress(entryId)\n      };\n      if (options.trackSelectionCallback) {\n        configuration[\"trackSelectionCallback\"] = options.trackSelectionCallback;\n      }\n      storage.configure(configuration);\n      return storage;\n    }\n  }, {\n    key: '_setDownloadProgress',\n    value: function _setDownloadProgress(entryId) {\n      var _this7 = this;\n\n      return function (content, progress) {\n        var event = new _playkitJs.FakeEvent(PROGRESS_EVENT, {\n          detail: {\n            content: content,\n            progress: progress * 100,\n            entryId: entryId\n          }\n        });\n        _this7.dispatchEvent(event);\n      };\n    }\n  }]);\n\n  return ShakaOfflineWrapper;\n}(_playkitJs.FakeEventTarget);\n\nexports.default = ShakaOfflineWrapper;\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _idb = __webpack_require__(6);\n\nvar _idb2 = _interopRequireDefault(_idb);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar KEY_PATH = 'entryId';\nvar ENTRIES_MAP_STORE_NAME = 'entriesMap';\nvar DB_NAME = 'offline-manager';\n/**\n * Your class description.\n * @classdesc\n */\n\nvar DBManager = function () {\n\n  /**\n   * @constructor\n   * @param {Object} config - The plugin config.\n   */\n  function DBManager(config) {\n    _classCallCheck(this, DBManager);\n\n    if (!('indexedDB' in window)) {\n      // console.log('This browser doesn\\'t support IndexedDB');\n      return;\n    }\n    this.config = config;\n    this.open(DB_NAME);\n  }\n\n  _createClass(DBManager, [{\n    key: 'open',\n    value: function open(store) {\n      this.dbPromise = _idb2.default.open(store, 1, function (upgradeDb) {\n        if (!upgradeDb.objectStoreNames.contains(ENTRIES_MAP_STORE_NAME)) {\n          upgradeDb.createObjectStore(ENTRIES_MAP_STORE_NAME, { keyPath: KEY_PATH });\n        }\n      });\n    }\n  }, {\n    key: 'add',\n    value: function add(storeName, key, item) {\n      var _this = this;\n\n      return this.dbPromise.then(function (db) {\n        var tx = db.transaction(storeName, 'readwrite');\n        var store = tx.objectStore(storeName);\n        _this._addConfigToItem(item);\n        item[KEY_PATH] = key;\n        store.put(item);\n        return tx.complete;\n      }).then(function () {\n        //console.log('added item ' + key);\n      });\n    }\n  }, {\n    key: 'remove',\n    value: function remove(storeName, key) {\n      return this.dbPromise.then(function (db) {\n        var tx = db.transaction(storeName, 'readwrite');\n        tx.objectStore(storeName).delete(key);\n        return tx.complete;\n      });\n    }\n  }, {\n    key: 'get',\n    value: function get(storeName, entryId) {\n      return this.dbPromise.then(function (db) {\n        return db.transaction(storeName).objectStore(storeName).get(entryId);\n      }).then(function (obj) {\n        return obj;\n      });\n    }\n  }, {\n    key: 'getAll',\n    value: function getAll(storeName) {\n      return this.dbPromise.then(function (db) {\n        return db.transaction(storeName).objectStore(storeName).getAll();\n      }).then(function (allObjs) {\n        return allObjs;\n      });\n    }\n  }, {\n    key: 'removeAll',\n    value: function removeAll(store) {\n      return store; //TODO implement\n    }\n  }, {\n    key: 'update',\n    value: function update(store, key, value) {\n      return this.add(store, key, value);\n    }\n  }, {\n    key: '_addConfigToItem',\n    value: function _addConfigToItem(item) {\n      for (var key in this.config) {\n        item[key] = this.config[key];\n      }\n    }\n  }]);\n\n  return DBManager;\n}();\n\nexports.default = DBManager;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (true) {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// playkit-offline-manager.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c44ca3d49c29ac55e7c6","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"playkit-js\",\"commonjs2\":\"playkit-js\",\"amd\":\"playkit-js\",\"root\":[\"playkit\",\"core\"]}\n// module id = 0\n// module chunks = 0","// @flow\nimport OfflineManager from './offline-manager'\n\ndeclare var __VERSION__: string;\ndeclare var __NAME__: string;\n\nexport {OfflineManager};\nexport {__VERSION__ as VERSION, __NAME__ as NAME};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","// @flow\nimport ShakaOfflineWrapper from './shaka-offline-wrapper'\nimport {Provider} from 'playkit-js-providers'\nimport {Utils,FakeEventTarget,EventManager} from 'playkit-js'\n\n/**\n * Your class description.\n * @classdesc\n */\nexport default class OfflineManager extends FakeEventTarget{\n\n  /**\n   * TODO: Define under what conditions the plugin is valid.\n   * @static\n   * @public\n   * @returns {boolean} - Whether the plugin is valid.\n   */\n  static isValid(): boolean {\n    return true;\n  }\n\n  /**\n   * @constructor\n   * @param {Object} config - The plugin config.\n   */\n  constructor(config) {\n    super();\n    if (this._downloads){\n      return;\n    }\n    // this.config = config;\n    this._downloads = {};\n    this._config = config;\n    this._eventManager = new EventManager();\n    this._setOfflineAdapter();\n\n    /**\n     Now you have access to the BasePlugin members:\n     1. config: The runtime configuration of the plugin.\n     2. name: The name of the plugin.\n     3. logger: The logger of the plugin.\n     4. player: Reference to the actual player.\n     5. eventManager: The event manager of the plugin.\n    */\n  }\n\n\n  _setOfflineAdapter(): void{\n    // if (this.config.manager === 'shaka'){\n      this._offlineManager = new ShakaOfflineWrapper(this._downloads);\n      this._eventManager.listen(this._offlineManager,\"progress\",(e)=>{\n        debugger;\n        this.dispatchEvent(e)});\n    // }\n  }\n\n  getMediaInfo(mediaInfo: Object): Promise<*>{\n    return new Promise((resolve, reject)=>{\n      const provider = new Provider(this._config.provider);\n      provider.getMediaConfig(mediaInfo)\n        .then(mediaConfig => {\n          if( Utils.Object.hasPropertyPath(mediaConfig, 'sources.dash') && mediaConfig.sources.dash.length > 0){\n            let sourceData = mediaConfig.sources.dash[0];\n            sourceData.entryId = mediaInfo.entryId;\n            this._downloads[mediaInfo.entryId] = mediaConfig;\n            resolve(sourceData);\n          }else{\n            reject(\"getMediaInfo error\");\n          }\n        });\n    })\n  }\n\n  pause(entryId): Promise<*>{\n    return this._offlineManager.pause(entryId);\n  }\n\n  resume(entryId): Promise<*>{\n    return this._offlineManager.resume(entryId);\n  }\n\n  download(url: string, options: Object): Promise<*>{\n    return this._offlineManager.download(url, options);\n  }\n\n  deleteMedia(entryId: string): Promise<*>{\n    return this._offlineManager.deleteMedia(entryId);\n  }\n\n  getMediaInfoFromDB(entryId: string): Promise<*>{\n    return this._offlineManager.getDataByEntry(entryId);\n  }\n\n  getAllDownloads(): Promise<*>{\n    return this._offlineManager.getAllDownloads();\n  }\n\n  /**\n   * TODO: Define the destroy logic of your plugin.\n   * Destroys the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   */\n  destroy(): void {\n    // Write logic\n    this._eventManager.destroy();\n  }\n\n  /**\n   * TODO: Define the reset logic of your plugin.\n   * Resets the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   */\n  reset(): void {\n  // Write logic\n  }\n\n\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./offline-manager.js","//flow\nimport shaka from 'shaka-player'\nimport DBManager from \"./db-manager\";\nimport {FakeEventTarget,FakeEvent} from 'playkit-js'\n\nconst downloadStates = {\n  DOWNLOADING: 'downloading',\n  PAUSED: 'paused',\n  RESUMED: 'resumed',\n  ENDED: 'ended'\n};\n\nconst actions = {\n  PAUSE: 'pause',\n  RESUME: 'resume',\n  DELETE: 'delete',\n  DOWNLOAD_START: 'downloadStart',\n  DOWNLOAD_END: 'downloadEnd'\n};\n\nconst ENTRIES_MAP_STORE_NAME = 'entriesMap';\n\nconst PROGRESS_EVENT = 'progress';\n\nexport default class ShakaOfflineWrapper extends FakeEventTarget{\n\n  constructor(downloads) {\n    super();\n    this._dtgVideoElement = document.createElement('video');\n    shaka.polyfill.installAll();\n\n    this._dtgShaka = new shaka.Player(this._dtgVideoElement);\n    if (shaka.log) {\n      shaka.log.setLevel(shaka.log.Level.DEBUG);\n    }\n\n    this._dbManager = new DBManager({\n      adapterName: 'shaka',\n      adapterVersion: \"\",//player.version,\n      playerVersion: \"\"//player.version\n    });\n    this._downloads = downloads;\n  }\n\n  download(entryId: String, options): Promise<*> {\n    let currentDownload = this._downloads[entryId];\n    this._configureDrmIfNeeded(entryId);\n    currentDownload['storage'] = this._initStorage(entryId,options);\n    currentDownload['state'] = downloadStates.DOWNLOADING;\n    return currentDownload.storage.store(currentDownload.sources.dash[0].url, {}).then(offlineManifest => {\n      currentDownload.state = offlineManifest.downloadStatus === downloadStates.PAUSED ? downloadStates.PAUSED : downloadStates.ENDED;\n      currentDownload.sources.dash[0].url = offlineManifest.offlineUri;\n      return this._dbManager.add(ENTRIES_MAP_STORE_NAME, entryId, this._prepareItemForStorage(currentDownload)).then(() => {\n        Promise.resolve({\n          action: actions.DOWNLOAD_START,\n          entryId: entryId\n        });\n      });\n    }).catch((e) => {\n      Promise.reject(e);\n    });\n\n  }\n\n\n  pause(entryId: string): Promise<*> {\n    let currentDownload = this._downloads[entryId];\n    if (!currentDownload) {\n      return Promise.resolve(\"not downloading / resuming\"); //TODO LOG THIS (until background fetch is here)\n    } else {\n      if ([downloadStates.DOWNLOADING, downloadStates.RESUMED].includes(currentDownload.state)) {\n        return currentDownload.storage.pause().then(() => {\n          currentDownload.state = downloadStates.PAUSED;\n          return this._dbManager.update(ENTRIES_MAP_STORE_NAME, entryId, this._prepareItemForStorage(currentDownload)).then(() => {\n            Promise.resolve({\n              entryId: entryId,\n              action: actions.PAUSE\n            });\n          });\n        }).catch((e) => {\n          Promise.reject(e);\n        });\n      } else {\n        return Promise.resolve();\n      }\n    }\n  }\n\n  resume(entryId: string): Promise<*> {\n    return this._setSessionData(entryId).then(() => {\n      let currentDownload = this._downloads[entryId];\n      if (currentDownload.state === downloadStates.PAUSED) {\n        currentDownload.state = downloadStates.RESUMED;\n        currentDownload.storage.resume(currentDownload.sources.dash[0].url).then((manifestDB) => {\n          currentDownload.state = [manifestDB.downloadStatus,manifestDB.ob].includes(downloadStates.ENDED) ? downloadStates.ENDED : downloadStates.PAUSED;\n          this._dbManager.update(ENTRIES_MAP_STORE_NAME, entryId, this._prepareItemForStorage(currentDownload)).then(() => {\n            return Promise.resolve({\n              action: actions.RESUME,\n              entryId: entryId\n            });\n          })\n        });\n      }\n    }).catch((e) => {\n      Promise.reject(e);\n    });\n  }\n\n\n  deleteMedia(entryId): Promise<*> {\n    return this._setSessionData(entryId).then(() => {\n      let currentDownload = this._downloads[entryId];\n      currentDownload.state = downloadStates.DELETED;\n\n      currentDownload.storage.remove(currentDownload.sources.dash[0].url).then(() => {\n        this._dbManager.remove(ENTRIES_MAP_STORE_NAME, entryId).then(() => {\n          delete this._downloads[entryId];\n          return Promise.resolve({\n            action: actions.DELETED,\n            entryId: entryId\n          });\n        })\n      });\n\n    }).catch((e) => {\n      Promise.reject(e);\n    });\n  }\n\n  getDataByEntry(entryId): Promise<*> {\n    return this._dbManager.get(ENTRIES_MAP_STORE_NAME, entryId);\n  }\n\n  getAllDownloads(): Promise<*> {\n    return this._dbManager.getAll(ENTRIES_MAP_STORE_NAME);\n  }\n\n\n  _configureDrmIfNeeded(entryId) {\n    let currentDownload = this._downloads[entryId];\n    const drmData = currentDownload.sources.dash[0].drmData;\n    if (drmData) {\n      let servers = {};\n      drmData.forEach((val) => {\n        servers[val.scheme] = val.licenseUrl;\n      });\n      this._dtgShaka.configure({'drm': {'servers': servers}})\n    } else {\n      this._dtgShaka.configure({});\n    }\n  }\n\n\n  _prepareItemForStorage(object) {\n    const keysToDelete = [\"storage\", \"url\", \"mimetype\"];\n    let storeObj = Object.assign({}, object);\n    for (let key in storeObj) {\n      if (keysToDelete.includes(key)) {\n        delete storeObj[key];\n      }\n    }\n    return storeObj;\n  }\n\n\n  _setSessionData(entryId): Promise<*> {\n    if (this._downloads[entryId]) {\n      return Promise.resolve();\n    }\n    return this.getDataByEntry(entryId).then(dbData => {\n      let data = Object.assign({}, dbData);\n      data['storage'] = this._initStorage(entryId);\n      this._downloads[entryId] = data;\n      return Promise.resolve();\n    });\n  }\n\n\n  _initStorage(entryId,options = {}) {\n    let storage = new shaka.offline.Storage(this._dtgShaka);\n    let configuration = {\n      usePersistentLicense: true,\n      progressCallback: this._setDownloadProgress(entryId),\n    };\n    if (options.trackSelectionCallback){\n      configuration[\"trackSelectionCallback\"] = options.trackSelectionCallback;\n    }\n    storage.configure(configuration);\n    return storage;\n  }\n\n  _setDownloadProgress(entryId) {\n    return (content, progress) => {\n      let event = new FakeEvent(PROGRESS_EVENT, {\n        detail: {\n          content: content,\n          progress: progress * 100,\n          entryId: entryId\n        }\n      });\n      this.dispatchEvent(event);\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./shaka-offline-wrapper.js","module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"shaka-player\",\"commonjs2\":\"shaka-player\",\"amd\":\"shaka-player\",\"root\":\"shaka\"}\n// module id = 4\n// module chunks = 0","// @flow\nimport idb from 'idb'\n\nconst KEY_PATH: string = 'entryId';\nconst ENTRIES_MAP_STORE_NAME: string = 'entriesMap';\nconst DB_NAME: string = 'offline-manager'\n/**\n * Your class description.\n * @classdesc\n */\nexport default class DBManager{\n\n\n  /**\n   * @constructor\n   * @param {Object} config - The plugin config.\n   */\n  constructor(config: Object) {\n    if (!('indexedDB' in window)) {\n     // console.log('This browser doesn\\'t support IndexedDB');\n      return;\n    }\n    this.config = config;\n    this.open(DB_NAME);\n  }\n\n  open(store){\n    this.dbPromise = idb.open(store, 1, (upgradeDb)=>{\n      if (!upgradeDb.objectStoreNames.contains(ENTRIES_MAP_STORE_NAME)) {\n        upgradeDb.createObjectStore(ENTRIES_MAP_STORE_NAME, {keyPath: KEY_PATH});\n      }\n    });\n  }\n\n  add(storeName, key ,item){\n    return this.dbPromise.then(db => {\n      let tx = db.transaction(storeName, 'readwrite');\n      let store = tx.objectStore(storeName);\n      this._addConfigToItem(item);\n      item[KEY_PATH] = key;\n      store.put(item);\n      return tx.complete;\n    }).then(()=> {\n      //console.log('added item ' + key);\n    });\n  }\n\n  remove(storeName,key){\n    return this.dbPromise.then(db => {\n      const tx = db.transaction(storeName, 'readwrite');\n      tx.objectStore(storeName).delete(key);\n      return tx.complete;\n    });\n  }\n\n  get(storeName, entryId){\n    return this.dbPromise.then(db => {\n      return db.transaction(storeName)\n        .objectStore(storeName).get(entryId);\n    }).then(obj =>{\n      return obj;\n    });\n  }\n\n  getAll(storeName){\n    return this.dbPromise.then(db => {\n      return db.transaction(storeName)\n        .objectStore(storeName).getAll();\n    }).then(allObjs => {\n      return allObjs;\n    });\n  }\n\n  removeAll(store){\n    return store; //TODO implement\n  }\n\n  update(store,key,value){\n    return this.add(store,key,value);\n  }\n\n  _addConfigToItem(item){\n    for (let key in this.config){\n      item[key] = this.config[key];\n    }\n  }\n\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./db-manager.js","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/idb/lib/idb.js\n// module id = 6\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"playkit-js-providers\",\"commonjs2\":\"playkit-js-providers\",\"amd\":\"playkit-js-providers\",\"root\":[\"playkit\",\"providers\"]}\n// module id = 7\n// module chunks = 0"],"sourceRoot":""}