{"version":3,"sources":["./offline-manager/webpack/universalModuleDefinition","./offline-manager/webpack/bootstrap 4a2b1410fbb23f56c1a3","./offline-manager/./db-manager.js","./offline-manager/external {\"commonjs\":\"playkit-js\",\"commonjs2\":\"playkit-js\",\"amd\":\"playkit-js\",\"root\":[\"playkit\",\"core\"]}","./offline-manager/./index.js","./offline-manager/./offline-manager.js","./offline-manager/./shaka-offline-wrapper.js","./offline-manager/external {\"commonjs\":\"shaka-player\",\"commonjs2\":\"shaka-player\",\"amd\":\"shaka-player\",\"root\":\"shaka\"}","./offline-manager/../node_modules/idb/lib/idb.js","./offline-manager/external {\"commonjs\":\"playkit-js-providers\",\"commonjs2\":\"playkit-js-providers\",\"amd\":\"playkit-js-providers\",\"root\":[\"playkit\",\"providers\"]}"],"names":["KEY_PATH","ENTRIES_MAP_STORE_NAME","DB_NAME","DBManager","config","window","console","log","open","store","dbPromise","upgradeDb","objectStoreNames","contains","createObjectStore","keyPath","storeName","key","item","then","tx","db","transaction","objectStore","_addConfigToItem","put","complete","delete","entryId","get","obj","getAll","allObj","value","add","OfflineManager","VERSION","NAME","_downloads","_setOfflineAdapter","_offlineManager","player","mediaInfo","Promise","resolve","reject","provider","getMediaConfig","Object","hasPropertyPath","mediaConfig","sources","dash","length","sourceData","pause","resume","url","options","download","deleteMedia","defaultConfig","downloads","downloadStates","DOWNLOADING","PAUSED","RESUMED","ENDED","actions","PAUSE","RESUME","DELETE","DOWNLOAD_START","DOWNLOAD_END","ShakaOfflineWrapper","_dtgVideoElement","document","createElement","polyfill","installAll","_dtgShaka","Player","setLevel","Level","DEBUG","_dbManager","adapterName","adapterVersion","playerVersion","metadata","currentDownload","_initStorage","storage","offlineUri","offlineManifest","state","action","_getDownloadedMetadataByEntryId","_setSessionData","remove","dbData","includes","status","update","preferences","data","offline","Storage","callback","_setDownloadProgress","configure","progressCallback","content","progress","postMessage"],"mappings":"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A;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;ACtTD,+C","file":"playkit-offline-manager.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"playkit-js\"), require(\"shaka-player\"), require(\"playkit-js-providers\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"playkit-js\", \"shaka-player\", \"playkit-js-providers\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"OfflineManager\"] = factory(require(\"playkit-js\"), require(\"shaka-player\"), require(\"playkit-js-providers\"));\n\telse\n\t\troot[\"playkit\"] = root[\"playkit\"] || {}, root[\"playkit\"][\"OfflineManager\"] = factory(root[\"playkit\"][\"core\"], root[\"shaka\"], root[\"playkit\"][\"providers\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4a2b1410fbb23f56c1a3","// @flow\nimport {Utils} from 'playkit-js'\nimport idb from 'idb'\n\nconst KEY_PATH: string = 'entryId';\nconst ENTRIES_MAP_STORE_NAME: string = 'entriesMap';\nconst DB_NAME: string = 'offline-manager'\n/**\n * Your class description.\n * @classdesc\n */\nexport default class DBManager{\n\n\n  /**\n   * @constructor\n   * @param {string} name - The plugin name.\n   * @param {Player} player - The player instance.\n   * @param {Object} config - The plugin config.\n   */\n  constructor(config: Object) {\n    if (!('indexedDB' in window)) {\n      console.log('This browser doesn\\'t support IndexedDB');\n      return;\n    }\n    this.config = config;\n    this.open(DB_NAME);\n  }\n\n  open(store){\n    this.dbPromise = idb.open(store, 1, (upgradeDb)=>{\n      if (!upgradeDb.objectStoreNames.contains(ENTRIES_MAP_STORE_NAME)) {\n        upgradeDb.createObjectStore(ENTRIES_MAP_STORE_NAME, {keyPath: KEY_PATH});\n      }\n    });\n  }\n\n  add(storeName, key ,item){\n    return this.dbPromise.then(db => {\n      var tx = db.transaction(storeName, 'readwrite');\n      var store = tx.objectStore(storeName);\n      this._addConfigToItem(item);\n      item[KEY_PATH] = key;\n      store.put(item);\n      return tx.complete;\n    }).then(()=> {\n      console.log('added item ' + key);\n    });\n  }\n\n  remove(storeName,key){\n    return dbPromise.then(db => {\n      const tx = db.transaction(storeName, 'readwrite');\n      tx.objectStore(storeName).delete(key);\n      return tx.complete;\n    });\n  }\n\n  get(storeName, entryId){\n    return dbPromise.then(db => {\n      return db.transaction(storeName)\n        .objectStore(storeName).get(entryId);\n    }).then(obj =>{\n      return obj;\n    });\n  }\n\n  getAll(storeName){\n    return dbPromise.then(db => {\n      return db.transaction(storeName)\n        .objectStore(storeName).getAll();\n    }).then(allObjs => {\n      return allObj;\n    });\n  }\n\n  removeAll(store){\n\n  }\n\n  update(store,key,value){\n    this.add(store,key,value);\n  }\n\n  _addConfigToItem(item){\n    for (let key in this.config){\n      item[key] = config.key;\n    }\n  }\n\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./db-manager.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"playkit-js\",\"commonjs2\":\"playkit-js\",\"amd\":\"playkit-js\",\"root\":[\"playkit\",\"core\"]}\n// module id = 1\n// module chunks = 0","// @flow\nimport OfflineManager from './offline-manager'\n\ndeclare var __VERSION__: string;\ndeclare var __NAME__: string;\n\nexport {OfflineManager};\nexport {__VERSION__ as VERSION, __NAME__ as NAME};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","// @flow\nimport ShakaOfflineWrapper from './shaka-offline-wrapper'\nimport {Provider} from 'playkit-js-providers'\nimport {Utils} from 'playkit-js'\nimport {dbManager} from 'db-manager'\nimport DBManager from \"./db-manager\";\n\n\n/**\n * Your class description.\n * @classdesc\n */\nexport default class OfflineManager{\n  /**\n   * TODO: Override and define your default configuration for the plugin.\n   * The default configuration of the plugin.\n   * @type {Object}\n   * @static\n   */\n  static defaultConfig: Object = {};\n\n  static downloads: Object = {};\n\n  /**\n   * TODO: Define under what conditions the plugin is valid.\n   * @static\n   * @public\n   * @returns {boolean} - Whether the plugin is valid.\n   */\n  static isValid(): boolean {\n    return true;\n  }\n\n  /**\n   * @constructor\n   * @param {string} name - The plugin name.\n   * @param {Player} player - The player instance.\n   * @param {Object} config - The plugin config.\n   */\n  constructor(config: Object) {\n    //super(player,config);\n    //this.player = player;\n    this.config = config;\n    this._downloads = {};\n    this._setOfflineAdapter();\n\n    /**\n     Now you have access to the BasePlugin members:\n     1. config: The runtime configuration of the plugin.\n     2. name: The name of the plugin.\n     3. logger: The logger of the plugin.\n     4. player: Reference to the actual player.\n     5. eventManager: The event manager of the plugin.\n    */\n  }\n\n\n  _setOfflineAdapter(): void{\n    // if (this.config.manager === 'shaka'){\n      this._offlineManager = new ShakaOfflineWrapper(this._downloads, this.player);\n    // }\n  }\n\n  getMediaInfo(mediaInfo: Object): Promise<*>{\n    return new Promise((resolve, reject)=>{\n      const provider = new Provider(this.config.provider);\n      provider.getMediaConfig(mediaInfo)\n        .then(mediaConfig => {\n          if( Utils.Object.hasPropertyPath(mediaConfig, 'sources.dash') && mediaConfig.sources.dash.length > 0){\n            let sourceData = mediaConfig.sources.dash[0];\n            sourceData.entryId = mediaInfo.entryId;\n            this._downloads[mediaInfo.entryId] = sourceData;\n            resolve(sourceData);\n          }else{\n            reject(\"getMediaInfo error\");\n          }\n        });\n    })\n  }\n\n  pause(entryId): Promise<*>{\n    return this._offlineManager.pause(entryId);\n  }\n\n  resume(entryId): Promise<*>{\n    return this._offlineManager.resume(entryId);\n  }\n\n  download(url: string, options: Object): Promise<*>{\n    return this._offlineManager.download(url, options);\n  }\n\n  deleteMedia(entryId: string): Promise<*>{\n    return this._offlineManager.deleteMedia(entryId);\n  }\n\n  /**\n   * TODO: Define the destroy logic of your plugin.\n   * Destroys the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   */\n  destroy(): void {\n    // Write logic\n  }\n\n  /**\n   * TODO: Define the reset logic of your plugin.\n   * Resets the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   */\n  reset(): void {\n  // Write logic\n  }\n\n\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./offline-manager.js","//flow\nimport shaka from 'shaka-player'\nimport DBManager from \"./db-manager\";\n\nconst downloadStates = {\n  DOWNLOADING: 'downloading',\n  PAUSED: 'paused',\n  RESUMED: 'resumed',\n  ENDED: 'ended'\n};\n\nconst actions = {\n  PAUSE: 'pause',\n  RESUME: 'resume',\n  DELETE: 'delete',\n  DOWNLOAD_START: 'downloadStart',\n  DOWNLOAD_END: 'downloadEnd'\n};\n\nconst ENTRIES_MAP_STORE_NAME = 'entriesMap';\n\nexport default class ShakaOfflineWrapper {\n  constructor(downloads, player) {\n    this._dtgVideoElement = document.createElement('video');\n    shaka.polyfill.installAll();\n\n    this._dtgShaka = new shaka.Player(this._dtgVideoElement);\n    if (shaka.log){\n      shaka.log.setLevel(shaka.log.Level.DEBUG);\n    }\n\n    this._dbManager = new DBManager({\n      adapterName: 'shaka',\n      adapterVersion: \"\",//player.version,\n      playerVersion: \"\"//player.version\n    });\n    this._downloads = downloads;\n  }\n\n\n  download(entryId: string, metadata: Object): promise<*> {\n    let currentDownload = this._downloads[entryId];\n    currentDownload['storage'] = this._initStorage();\n\n    return currentDownload.storage.store(currentDownload.url, metadata).then(offlineManifest => {\n      const item = {\n        offlineUri: offlineManifest.offlineUri,\n        entryId: entryId,\n        state: downloadStates.DOWNLOADING\n      };\n      this._dbManager.add(ENTRIES_MAP_STORE_NAME, entryId, item).then(()=>{\n        Promise.resolve({\n          action: actions.DOWNLOAD_END,\n          entryId: entryId\n        });\n      });\n    });\n  }\n\n  deleteMedia(entryId): promise<*> {\n    this._getDownloadedMetadataByEntryId(entryId).then(dbData => {\n        this._setSessionData();\n        let storage = this._downloads.entryId.storage;\n        storage.remove(dbData.offlineUri).then(() => {\n          Promise.resolve({\n            action: action.delete,\n            entryId: entryId\n          });\n        });\n    });\n  }\n\n  pause(entryId): promise<*> {\n    if (!this._downloads.entryId) {\n      Promise.resolve(\"not downloading / resuming\"); //TODO LOG THIS (until background fetch is here)\n    }else{\n      if ([downloadStates.DOWNLOADING, downloadStates.RESUMED].includes(dbData.status)) {\n        this._downloads.entryId.storage.pause().then(()=>{\n          const item = {\n            entryId: entryId,\n            state: downloadStates.PAUSED\n          };\n          this._dbManager.update(ENTRIES_MAP_STORE_NAME, entryId, item).then(()=>{\n            Promise.resolve({\n              action: actions.DOWNLOAD_END,\n              entryId: entryId\n            });\n          });\n        });\n\n        Promise.resolve({\n          entryId: entryId,\n          action: actions.PAUSE\n        });\n      }\n    }\n\n\n\n  }\n\n  resume(entryId): promise<*> {\n\n    this._getDownloadedMetadataByEntryId(entryId).then(dbData => {\n      if (dbData.status === downloadStates.PAUSED) {\n        this._setSessionData();\n        let storage = this._downloads.entryId.storage;\n        storage.resume(preferences.offlineUri).then(() => {\n          Promise.resolve({\n            action: action.RESUME,\n            entryId: entryId\n          });\n        });\n      }\n    });\n  }\n\n\n\n  _setSessionData(entryId): promise<*> {\n    if (this._downloads.entryId) {\n      return this._downloads.entryId;\n    }\n    const data = {\n      storage: this._initStorage(),\n      status: null\n    }\n    this._downloads[entryId] = data;\n  }\n\n  _getDownloadedMetadataByEntryId(entryId): promise<*> {\n    return this._dbManager.get(ENTRIES_MAP_STORE_NAME, entryId);\n  }\n\n\n  _initStorage() {\n    let storage = new shaka.offline.Storage(this._dtgShaka);\n    let callback = this._setDownloadProgress;\n\n    storage.configure({\n      progressCallback: this._setDownloadProgress\n    });\n    return storage;\n  }\n\n  _setDownloadProgress(content, progress) {\n    window.postMessage({content: content, progress: progress * 100}, '*');\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./shaka-offline-wrapper.js","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"shaka-player\",\"commonjs2\":\"shaka-player\",\"amd\":\"shaka-player\",\"root\":\"shaka\"}\n// module id = 5\n// module chunks = 0","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/idb/lib/idb.js\n// module id = 6\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"playkit-js-providers\",\"commonjs2\":\"playkit-js-providers\",\"amd\":\"playkit-js-providers\",\"root\":[\"playkit\",\"providers\"]}\n// module id = 7\n// module chunks = 0"],"sourceRoot":""}